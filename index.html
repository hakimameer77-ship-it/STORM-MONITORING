<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StormWatch Pro | Advanced Weather Intelligence</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #00d2ff;
            --danger: #ff4757;
            --warning: #ffa500;
            --bg-dark: #05070a;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
            --glass: blur(12px);
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background-color: var(--bg-dark); color: #fff; overflow-x: hidden; }

        /* --- NAVIGATION --- */
        .navbar { 
            position: fixed; top: 0; width: 100%; z-index: 2000; 
            background: rgba(5, 7, 10, 0.8); backdrop-filter: var(--glass);
            border-bottom: 1px solid var(--border); padding: 15px 0;
        }
        .nav-container { max-width: 1300px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
        .logo { font-size: 1.4rem; font-weight: 800; text-decoration: none; color: #fff; }
        .logo span { color: var(--primary); }
        .nav-links { display: flex; list-style: none; gap: 30px; }
        .nav-links a { text-decoration: none; color: #aaa; font-weight: 600; font-size: 0.9rem; transition: 0.3s; }
        .nav-links a:hover { color: var(--primary); }

        /* --- HERO SECTION --- */
        .hero { 
            height: 80vh; display: flex; align-items: center; justify-content: center; text-align: center;
            background: radial-gradient(circle at center, #0f172a 0%, #05070a 100%);
        }
        .hero-content h1 { font-size: clamp(2.5rem, 6vw, 4.5rem); font-weight: 800; margin-bottom: 20px; line-height: 1.1; }
        .hero-content p { color: #888; font-size: 1.1rem; max-width: 600px; margin: 0 auto 30px; }
        .btn { background: var(--primary); color: #000; padding: 12px 30px; border-radius: 50px; text-decoration: none; font-weight: 700; transition: 0.3s; }

        /* --- DASHBOARD GRID --- */
        section { padding: 80px 30px; max-width: 1300px; margin: 0 auto; }
        .section-header { margin-bottom: 40px; }
        .section-header h2 { font-size: 2rem; margin-bottom: 10px; }
        .section-header p { color: #888; }

        /* 1. MAP RADAR INTERAKTIF */
        #map-container { 
            height: 500px; width: 100%; border-radius: 30px; border: 1px solid var(--border); overflow: hidden; position: relative;
            background: #111;
        }
        .map-overlay { position: absolute; top: 20px; right: 20px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 15px; border: 1px solid var(--border); }

        /* 2. ANALYTICS & STATS */
        .grid-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: var(--card-bg); border: 1px solid var(--border); padding: 30px; border-radius: 25px; transition: 0.3s; }
        .card:hover { border-color: var(--primary); }
        .card i { font-size: 1.5rem; color: var(--primary); margin-bottom: 15px; }

        /* 3. AI PREDICTION */
        .ai-badge { background: linear-gradient(90deg, #00d2ff, #3a7bd5); color: #000; font-size: 0.7rem; font-weight: 800; padding: 4px 10px; border-radius: 50px; text-transform: uppercase; margin-bottom: 10px; display: inline-block; }

        /* --- NOTIFICATION POPUP --- */
        .notification { position: fixed; bottom: 30px; right: 30px; background: var(--danger); color: #fff; padding: 20px 30px; border-radius: 20px; z-index: 3000; display: none; animation: slideIn 0.5s ease; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* Chart */
        .chart-box { background: var(--card-bg); border: 1px solid var(--border); padding: 30px; border-radius: 30px; margin-top: 30px; height: 400px; }

        footer { text-align: center; padding: 60px 0; border-top: 1px solid var(--border); color: #555; font-size: 0.9rem; }

        @media (max-width: 768px) { .nav-links { display: none; } }
    </style>
</head>
<body>

    <div id="alert-popup" class="notification">
        <i class="fas fa-exclamation-triangle"></i> <strong>STORM ALERT!</strong> 
        <p id="alert-msg">Lightning detected within 10km.</p>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">STORM<span>WATCH</span></a>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#radar">Live Radar</a></li>
                <li><a href="#project">Interactive</a></li>
                <li><a href="#analytics">Analytics</a></li>
                <li><a href="#mission">Mission</a></li>
            </ul>
            <a href="javascript:void(0)" onclick="testAlert()" class="btn" style="font-size: 0.8rem; padding: 8px 20px;">NOTIFY ON</a>
        </div>
    </nav>

    <div class="hero" id="home">
        <div class="hero-content">
            <div class="ai-badge">AI Powered Detection</div>
            <h1>Smart Weather Intelligence</h1>
            <p>Beyond simple monitoring. We provide real-time radar layers, AI predictions, and personalized safety alerts.</p>
            <a href="#radar" class="btn">Launch Live Radar</a>
        </div>
    </div>

    <section id="radar">
        <div class="section-header">
            <span style="color: var(--primary); font-weight: 800;">[FITUR 1 & 4]</span>
            <h2>Interactive Radar Map</h2>
            <p>Live rain and storm layers integrated from Global Weather APIs (RainViewer).</p>
        </div>
        <div id="map-container">
            <div id="map" style="height: 100%; width: 100%;"></div>
            <div class="map-overlay">
                <p style="font-size: 0.8rem; font-weight: 800; margin-bottom: 10px;">MAP LAYERS</p>
                <button onclick="changeLayer('radar')" style="cursor:pointer; background: #222; color:#fff; border:none; padding: 5px 10px; border-radius: 5px;">Radar</button>
                <button onclick="changeLayer('satellite')" style="cursor:pointer; background: #222; color:#fff; border:none; padding: 5px 10px; border-radius: 5px;">Satellite</button>
            </div>
        </div>
    </section>

    <section id="project">
        <div class="section-header">
            <span style="color: var(--primary); font-weight: 800;">[FITUR 3, 5 & 6]</span>
            <h2>Interactive Project Dashboard</h2>
            <p>Personalized IoT data processed with AI prediction models.</p>
        </div>
        <div class="grid-stats">
            <div class="card">
                <p style="color: #666; font-size: 0.8rem; font-weight: 800;">CURRENT SENSOR READ</p>
                <h2 id="dist-val" style="font-size: 3rem; margin: 10px 0;">-- KM</h2>
                <div id="esp-status" style="color: var(--danger); font-size: 0.8rem;">● DISCONNECTED</div>
            </div>
            <div class="card">
                <div class="ai-badge">Machine Learning</div>
                <h3>Next Strike Prediction</h3>
                <p style="color: #888; margin-top: 10px;">Predicted Impact: <strong>14:25 MYT</strong></p>
                <p style="color: #888;">Confidence: <span style="color: var(--primary);">88%</span></p>
            </div>
            <div class="card">
                <i class="fas fa-location-dot"></i>
                <h3>Personalized Zone</h3>
                <p style="color: #888;">Location: <strong>UTHM, Parit Raja</strong></p>
                <p style="color: var(--warning); font-weight: bold; margin-top: 5px;">STATUS: HIGH RISK</p>
            </div>
        </div>

        <div class="chart-box" id="analytics">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Strike Trend Analysis (Weekly)</h3>
                <button onclick="downloadCSV()" style="background:none; border: 1px solid var(--border); color:#fff; padding: 5px 15px; border-radius: 5px; cursor:pointer;">Export CSV</button>
            </div>
            <div style="height: 300px;">
                <canvas id="weeklyChart"></canvas>
            </div>
        </div>
    </section>

    <section id="mission">
        <div class="card" style="text-align: center; border-radius: 50px;">
            <i class="fas fa-shield-heart" style="font-size: 3rem;"></i>
            <h2 style="margin-bottom: 20px;">Mission for Safety</h2>
            <p style="max-width: 800px; margin: 0 auto; font-size: 1.4rem; font-style: italic; color: #ddd;">
                "Our mission is to minimize the danger of outdoor activities by providing 
                precision weather intelligence through high-performance IoT sensors 
                and predictive AI technology."
            </p>
        </div>
    </section>

    <footer>
        <p id="myt-clock" style="color: var(--primary); font-weight: 800; font-size: 1.2rem;"></p>
        <p>STORM-WATCH PRO &copy; 2026 | Built by Ameer Hakim (CN230083)</p>
        <p style="margin-top: 10px; opacity: 0.5;">Integrated with Blynk IoT & Windy API Ecosystem</p>
    </footer>

    <script>
        const BLYNK_TOKEN = "pd3Q6apyv8yfY9lmqOu_9IF8Gy3ldLpd";
        const URL_V1 = `https://blynk.cloud/external/api/get?token=${BLYNK_TOKEN}&V1`;

        // 1. JAM REAL-TIME
        setInterval(() => {
            document.getElementById('myt-clock').innerText = new Date().toLocaleTimeString('en-US', { hour12: true }) + " (MYT)";
        }, 1000);

        // 2. LEAFLET MAP (Radar Integration)
        const map = L.map('map').setView([1.8548, 103.0844], 10); // Center at UTHM
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { opacity: 0.3 }).addTo(map);

        // Radar Overlay Simulation (RainViewer Style)
        const radarLayer = L.tileLayer('https://tilecache.rainviewer.com/v2/radar/1674123000/256/{z}/{x}/{y}/2/1_1.png', {
            opacity: 0.6
        }).addTo(map);

        function changeLayer(type) {
            if(type === 'satellite') {
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);
            } else {
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            }
        }

        // 3. CHART.JS (Analytics)
        const ctx = document.getElementById('weeklyChart').getContext('2d');
        const weeklyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Strikes Detected',
                    data: [12, 19, 3, 5, 2, 3, 10],
                    backgroundColor: '#00d2ff',
                    borderRadius: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { 
                    y: { grid: { color: '#111' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // 4. BLYNK DATA & ALERT SYSTEM
        async function fetchBlynk() {
            try {
                const res = await fetch(URL_V1);
                const data = await res.text();
                const dist = parseInt(data);

                if(!isNaN(dist)) {
                    document.getElementById('dist-val').innerText = dist + " KM";
                    document.getElementById('esp-status').innerText = "● DEVICE ONLINE";
                    document.getElementById('esp-status').style.color = "#00ff88";

                    // AUTO ALERT TRIGGER
                    if(dist < 15) {
                        triggerAlert(`DANGER! Lightning detected at ${dist}km. Seek shelter immediately.`);
                    }
                }
            } catch(e) { 
                document.getElementById('esp-status').innerText = "● DEVICE OFFLINE";
                document.getElementById('esp-status').style.color = "#ff4757";
            }
        }

        function triggerAlert(msg) {
            const popup = document.getElementById('alert-popup');
            document.getElementById('alert-msg').innerText = msg;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 5000);
        }

        function testAlert() {
            triggerAlert("Personalized Alert: Storm detected moving towards UTHM Campus Zone.");
        }

        function downloadCSV() {
            alert("Exporting analytics data to StormWatch_Report.csv...");
        }

        setInterval(fetchBlynk, 5000);
        fetchBlynk();
    </script>
</body>
</html>
